gth&&delete this._listeners[e];break}}}};t.Namespace._moduleDefine(e,"WinJS.Utilities",{_createEventProperty:n,createEventProperties:r,eventMixin:o})}),t("WinJS/Core/_Trace",["WinJS/Core/_Global"],function(e){"use strict";function t(e){return e}return{_traceAsyncOperationStarting:e.Debug&&e.Debug.msTraceAsyncOperationStarting&&e.Debug.msTraceAsyncOperationStarting.bind(e.Debug)||t,_traceAsyncOperationCompleted:e.Debug&&e.Debug.msTraceAsyncOperationCompleted&&e.Debug.msTraceAsyncOperationCompleted.bind(e.Debug)||t,_traceAsyncCallbackStarting:e.Debug&&e.Debug.msTraceAsyncCallbackStarting&&e.Debug.msTraceAsyncCallbackStarting.bind(e.Debug)||t,_traceAsyncCallbackCompleted:e.Debug&&e.Debug.msTraceAsyncCallbackCompleted&&e.Debug.msTraceAsyncCallbackCompleted.bind(e.Debug)||t}}),t("WinJS/Promise/_StateMachine",["WinJS/Core/_Global","WinJS/Core/_BaseCoreUtils","WinJS/Core/_Base","WinJS/Core/_ErrorFromName","WinJS/Core/_Events","WinJS/Core/_Trace"],function(e,t,n,r,i,o){"use strict";function s(){}function a(e,t){var n;n=t&&"object"==typeof t&&"function"==typeof t.then?U:R,e._value=t,e._setState(n)}function u(e,t,n,r,i,o){return{exception:e,error:t,promise:n,handler:o,id:r,parent:i}}function l(e,t,n,r){var i=n._isException,o=n._errorId;return u(i?t:null,i?null:t,e,o,n,r)}function c(e,t,n){var r=n._isException,i=n._errorId;return b(e,i,r),u(r?t:null,r?null:t,e,i,n)}function f(e,t){var n=++q;return b(e,n),u(null,t,e,n)}function h(e,t){var n=++q;return b(e,n,!0),u(t,null,e,n)}function p(e,t,n,r){var i=o._traceAsyncOperationStarting("WinJS.Promise.done");y(e,{c:t,e:n,p:r,asyncOpID:i})}function m(e,t,n,r){e._value=t,_(e,t,n,r),e._setState(F)}function d(t,n){var r=t._value,i=t._listeners;if(i){t._listeners=null;var s,a;for(s=0,a=Array.isArray(i)?i.length:1;s<a;s++){var u=1===a?i:i[s],l=u.c,c=u.promise;if(o._traceAsyncOperationCompleted(u.asyncOpID,e.Debug&&e.Debug.MS_ASYNC_OP_STATUS_SUCCESS),c){o._traceAsyncCallbackStarting(u.asyncOpID);try{c._setCompleteValue(l?l(r):r)}catch(f){c._setExceptionValue(f)}finally{o._traceAsyncCallbackCompleted()}c._state!==U&&c._listeners&&n.push(c)}else J.prototype.done.call(t,l)}}}function g(t,n){var r=t._value,i=t._listeners;if(i){t._listeners=null;var s,a;for(s=0,a=Array.isArray(i)?i.length:1;s<a;s++){var u=1===a?i:i[s],c=u.e,f=u.promise,h=e.Debug&&(r&&r.name===M?e.Debug.MS_ASYNC_OP_STATUS_CANCELED:e.Debug.MS_ASYNC_OP_STATUS_ERROR);if(o._traceAsyncOperationCompleted(u.asyncOpID,h),f){var p=!1;try{c?(o._traceAsyncCallbackStarting(u.asyncOpID),p=!0,c.handlesOnError||_(f,r,l,t,c),f._setCompleteValue(c(r))):f._setChainedErrorValue(r,t)}catch(m){f._setExceptionValue(m)}finally{p&&o._traceAsyncCallbackCompleted()}f._state!==U&&f._listeners&&n.push(f)}else H.prototype.done.call(t,null,c)}}}function _(e,t,n,r,i){if(w._listeners[P]){if(t instanceof Error&&t.message===M)return;w.dispatchEvent(P,n(e,t,r,i))}}function v(e,t){var n=e._listeners;if(n){var r,i;for(r=0,i=Array.isArray(n)?n.length:1;r<i;r++){var o=1===i?n:n[r],s=o.p;if(s)try{s(t)}catch(a){}o.c||o.e||!o.promise||o.promise._progress(t)}}}function y(e,t){var n=e._listeners;n?(n=Array.isArray(n)?n:[n],n.push(t)):n=t,e._listeners=n}function b(e,t,n){e._isException=n||!1,e._errorId=t}function C(e,t,n,r){e._value=t,_(e,t,n,r),e._setState(Y)}function S(e,t){var n;n=t&&"object"==typeof t&&"function"==typeof t.then?U:W,e._value=t,e._setState(n)}function E(e,t,n,r){var i=new V(e),s=o._traceAsyncOperationStarting("WinJS.Promise.then");return y(e,{promise:i,c:t,e:n,p:r,asyncOpID:s}),i}function L(n){var r;return new G(function(i){n?r=e.setTimeout(i,n):t._setImmediate(i)},function(){r&&e.clearTimeout(r)})}function A(e,t){var n=function(){t.cancel()},r=function(){e.cancel()};return e.then(n),t.then(r,r),t}e.Debug&&(e.Debug.setNonUserCodeExceptions=!0);var N=n.Class.mix(n.Class.define(null,{},{supportedForProcessing:!1}),i.eventMixin),w=new N;w._listeners={};var P="error",M="Canceled",T=!1,x={promise:1,thenPromise:2,errorPromise:4,exceptionPromise:8,completePromise:16};x.all=x.promise|x.thenPromise|x.errorPromise|x.exceptionPromise|x.completePromise;var O,k,U,D,K,I,R,W,F,Y,q=1;O={name:"created",enter:function(e){e._setState(k)},cancel:s,done:s,then:s,_completed:s,_error:s,_notify:s,_progress:s,_setCompleteValue:s,_setErrorValue:s},k={name:"working",enter:s,cancel:function(e){e._setState(K)},done:p,then:E,_completed:a,_error:m,_notify:s,_progress:v,_setCompleteValue:S,_setErrorValue:C},U={name:"waiting",enter:function(e){var t=e._value;if(t instanceof V&&t._state!==Y&&t._state!==W)y(t,{promise:e});else{var n=function(r){t._errorId?e._chainedError(r,t):(_(e,r,l,t,n),e._error(r))};n.handlesOnError=!0,t.then(e._completed.bind(e),n,e._progress.bind(e))}},cancel:function(e){e._setState(D)},done:p,then:E,_completed:a,_error:m,_notify:s,_progress:v,_setCompleteValue:S,_setErrorValue:C},D={name:"waiting_canceled",enter:function(e){e._setState(I);var t=e._value;t.cancel&&t.cancel()},cancel:s,done:p,then:E,_completed:a,_error:m,_notify:s,_progress:v,_setCompleteValue:S,_setErrorValue:C},K={name:"canceled",enter:function(e){e._setState(I),e._cancelAction()},cancel:s,done:p,then:E,_completed:a,_error:m,_notify:s,_progress:v,_setCompleteValue:S,_setErrorValue:C},I={name:"canceling",enter:function(e){var t=new Error(M);t.name=t.message,e._value=t,e._setState(F)},cancel:s,done:s,then:s,_completed:s,_error:s,_notify:s,_progress:s,_setCompleteValue:s,_setErrorValue:s},R={name:"complete_notify",enter:function(e){if(e.done=J.prototype.done,e.then=J.prototype.then,e._listeners)for(var t,n=[e];n.length;)t=n.shift(),t._state._notify(t,n);e._setState(W)},cancel:s,done:null,then:null,_completed:s,_error:s,_notify:d,_progress:s,_setCompleteValue:s,_setErrorValue:s},W={name:"success",enter:function(e){e.done=J.prototype.done,e.then=J.prototype.then,e._cleanupAction()},cancel:s,done:null,then:null,_completed:s,_error:s,_notify:d,_progress:s,_setCompleteValue:s,_setErrorValue:s},F={name:"error_notify",enter:function(e){if(e.done=H.prototype.done,e.then=H.prototype.then,e._listeners)for(var t,n=[e];n.length;)t=n.shift(),t._state._notify(t,n);e._setState(Y)},cancel:s,done:null,then:null,_completed:s,_error:s,_notify:g,_progress:s,_setCompleteValue:s,_setErrorValue:s},Y={name:"error",enter:function(e){e.done=H.prototype.done,e.then=H.prototype.then,e._cleanupAction()},cancel:s,done:null,then:null,_completed:s,_error:s,_notify:g,_progress:s,_setCompleteValue:s,_setErrorValue:s};var j,z=n.Class.define(null,{_listeners:null,_nextState:null,_state:null,_value:null,cancel:function(){this._state.cancel(this),this._run()},done:function(e,t,n){this._state.done(this,e,t,n)},then:function(e,t,n){return this._state.then(this,e,t,n)},_chainedError:function(e,t){var n=this._state._error(this,e,c,t);return this._run(),n},_completed:function(e){var t=this._state._completed(this,e);return this._run(),t},_error:function(e){var t=this._state._error(this,e,f);return this._run(),t},_progress:function(e){this._state._progress(this,e)},_setState:function(e){this._nextState=e},_setCompleteValue:function(e){this._state._setCompleteValue(this,e),this._run()},_setChainedErrorValue:function(e,t){var n=this._state._setErrorValue(this,e,c,t);return this._run(),n},_setExceptionValue:function(e){var t=this._state._setErrorValue(this,e,h);return this._run(),t},_run:function(){for(;this._nextState;)this._state=this._nextState,this._nextState=null,this._state.enter(this)}},{supportedForProcessing:!1}),V=n.Class.derive(z,function(e){T&&(T===!0||T&x.thenPromise)&&(this._stack=G._getStack()),this._creator=e,this._setState(O),this._run()},{_creator:null,_cancelAction:function(){this._creator&&this._creator.cancel()},_cleanupAction:function(){this._creator=null}},{supportedForProcessing:!1}),H=n.Class.define(function(e){T&&(T===!0||T&x.